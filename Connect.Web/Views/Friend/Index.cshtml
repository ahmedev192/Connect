@using System.Security.Claims
@using Connect.Application.StaticDetails
@model FriendshipsViewModel;

<main id="site__main" class="p-2.5 h-[calc(100vh-var(--m-top))] mt-[--m-top] xl:ml-[--w-side-sm] 2xl:ml-[--w-side]">

	<div class="mx-auto max-w-[1065px] 2xl:max-w-[1220px]">

		@if (Model.Friends.Count > 0)
		{
			<div class="my-3 flex items-center justify-between sm:my-6">
				<div>
					<h2 class="text-black text-base text-lg font-semibold">My Friends</h2>
					<p class="text-gray-500 text-sm font-normal leading-6"> Your personal network of friends and acquaintances. Connect, share, and stay in touch with the people who matter to you.</p>
				</div>
			</div>

			<div class="gap-2 grid grid-cols-2">
				@foreach (var _friendship in Model.Friends)
				{
					var friend = _friendship.SenderId == int.Parse(User.FindFirstValue(System.Security.Claims.ClaimTypes.NameIdentifier)) ?
					_friendship.Receiver :
					_friendship.Sender;
					<div class="space-x-4 p-4 box flex rounded-md md:items-center">

						<div class="w-14 h-14 relative flex-shrink-0 rounded-lg">
							<img src="@(friend.ProfilePictureUrl)"
								 class="inset-0 absolute h-full w-full rounded-md object-cover shadow-sm" />
						</div>

						<div class="flex-1">
							<a asp-controller="User" asp-action="UserDetails" asp-route-userId="@friend.Id" class="text-black text-base font-semibold capitalize">@friend.FullName</a>
						</div>

						<form asp-controller="Friend" asp-action="RemoveFriend" method="post">
							<input type="hidden" name="friendshipId" value="@_friendship.Id" />
							<button type="submit" class="button bg-red-soft text-red gap-1 max-md:hidden">
								<ion-icon name="remove-circle-outline" class="-ml-1 text-xl"></ion-icon> Remove
							</button>
						</form>
					</div>
				}
			</div>
		}

		@if (Model.RecievedRequests.Count > 0)
		{
			<div class="my-3 flex items-center justify-between sm:my-6">
				<div>
					<h2 class="text-black text-base text-lg font-semibold">Received Requests</h2>
					<p class="text-gray-500 text-sm font-normal leading-6">See who wants to connect with you! Review and respond to incoming friend requests to expand your circle.</p>
				</div>
			</div>

			<div class="gap-2 grid grid-cols-2">
				@foreach (var request in Model.RecievedRequests)
				{
					<div class="space-x-4 p-4 box flex rounded-md md:items-center">

						<div class="w-14 h-14 relative flex-shrink-0 rounded-lg">
							<img src="@(request.Sender.ProfilePictureUrl)"
								 class="inset-0 absolute h-full w-full rounded-md object-cover shadow-sm" />
						</div>

						<div class="flex-1">
							<a asp-controller="User" asp-action="UserDetails" asp-route-userId="@request.Sender.Id" class="text-black text-base font-semibold capitalize">@request.Sender.FullName</a>
						</div>

						<form asp-controller="Friend" asp-action="UpdateFriendRequest" method="post">
							<input type="hidden" name="status" value="@FriendshipStatus.Rejected" />
							<input type="hidden" name="requestId" value="@request.Id" />
							<button type="submit" class="button bg-red-soft text-red gap-1 max-md:hidden">
								<ion-icon name="remove-circle-outline" class="-ml-1 text-xl"></ion-icon> Reject
							</button>
						</form>

						<form asp-controller="Friend" asp-action="UpdateFriendRequest" method="post">
							<input type="hidden" name="status" value="@FriendshipStatus.Accepted" />
							<input type="hidden" name="requestId" value="@request.Id" />
							<button type="submit" class="button bg-primary-soft text-primary gap-1 max-md:hidden">
								<ion-icon name="checkbox-outline" class="-ml-1 text-xl"></ion-icon> Accept
							</button>
						</form>
					</div>
				}
			</div>
		}


		@if (Model.SentRequests.Count > 0)
		{
			<div class="my-3 flex items-center justify-between sm:my-6">
				<div>
					<h2 class="text-black text-base text-lg font-semibold">Pending Invitations</h2>
					<p class="text-gray-500 text-sm font-normal leading-6">Track the friend requests you’ve sent. See who hasn’t responded yet and manage your pending invitations</p>
				</div>
			</div>

			<div class="gap-2 grid grid-cols-2">
				@foreach (var request in Model.SentRequests)
				{
					<div class="space-x-4 p-4 box flex rounded-md md:items-center">

						<div class="w-14 h-14 relative flex-shrink-0 rounded-lg">
							<img src="@(request.Receiver.ProfilePictureUrl)"
								 class="inset-0 absolute h-full w-full rounded-md object-cover shadow-sm" />
						</div>

						<div class="flex-1">
							<a asp-controller="User" asp-action="UserDetails" asp-route-userId="@request.Receiver.Id" class="text-black text-base font-semibold capitalize">@request.Receiver.FullName</a>
						</div>

						<form asp-controller="Friend" asp-action="UpdateFriendRequest" method="post">
							<input type="hidden" name="requestId" value="@request.Id" />
							<input type="hidden" name="status" value="@FriendshipStatus.Canceled" />
							<button type="submit" class="button text-primary gap-1 max-md:hidden">
								<ion-icon name="remove-circle-outline" class="-ml-1 text-xl"></ion-icon> Cancel
							</button>
						</form>
					</div>
				}
			</div>
		}


	</div>
</main>